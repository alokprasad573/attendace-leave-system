<%- include('./partials/header', { title: 'Dashboard', user }) %>

<div class="row g-3">
  <div class="col-md-4">
    <div class="card shadow">
      <div class="card-body">
        <h5 class="card-title">Attendance</h5>
        <p class="text-muted mb-2"><%= user.role === 'Student' ? 'Your latest attendance' : 'Recent attendance entries' %></p>
        <ul class="list-group list-group-flush">
          <% if (attendance && attendance.length) { %>
            <% attendance.forEach(a => { %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>
                  <% if (a.user) { %><strong><%= a.user.name %></strong> – <% } %><%= new Date(a.date).toDateString() %>
                </span>
                <span class="badge bg-<%= a.status === 'Present' ? 'success' : 'danger' %>"><%= a.status %></span>
              </li>
            <% }) %>
          <% } else { %>
            <li class="list-group-item text-muted">No attendance data</li>
          <% } %>
        </ul>
        <div class="mt-3">
          <a href="<%= user.role === 'Student' ? '/attendance' : '/attendance/all' %>" class="btn btn-primary btn-sm">View all</a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card shadow">
      <div class="card-body">
        <h5 class="card-title">Leaves</h5>
        <p class="text-muted mb-2"><%= user.role === 'Student' ? 'Your recent leaves' : 'Pending leaves' %></p>
        <ul class="list-group list-group-flush">
          <% if (leaves && leaves.length) { %>
            <% leaves.forEach(l => { %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>
                  <% if (l.user) { %><strong><%= l.user.name %></strong> – <% } %><%= l.reason %>
                </span>
                <span class="badge bg-<%= l.status === 'approved' ? 'success' : l.status === 'rejected' ? 'danger' : 'warning' %>">
                  <%= l.status %>
                </span>
              </li>
            <% }) %>
          <% } else { %>
            <li class="list-group-item text-muted">No leave data</li>
          <% } %>
        </ul>
        <div class="mt-3">
          <a href="<%= user.role === 'Student' ? '/leave' : '/leave/all' %>" class="btn btn-warning btn-sm text-white">View all</a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card shadow">
      <div class="card-body">
        <h5 class="card-title">Quick Links</h5>
        <div class="d-grid gap-2">
          <% if (user.role === 'Student') { %>
            <a href="/attendance" class="btn btn-outline-primary">My Attendance</a>
            <a href="/leave" class="btn btn-outline-warning">My Leaves</a>
          <% } else { %>
            <a href="/attendance/all" class="btn btn-outline-primary">All Attendance</a>
            <a href="/leave/all" class="btn btn-outline-secondary">Manage Leaves</a>
          <% } %>
          <a href="/auth/logout" class="btn btn-outline-danger">Logout</a>
        </div>
        <% if (stats) { %>
          <hr>
          <p class="mb-1"><strong>Users:</strong> <%= stats.userCount %></p>
          <p class="mb-1"><strong>Attendance entries:</strong> <%= stats.attendanceCount %></p>
          <p class="mb-1"><strong>Pending leaves:</strong> <%= stats.leavePending %></p>
        <% } %>
      </div>
    </div>
  </div>
</div>

<%- include('./partials/footer') %>
